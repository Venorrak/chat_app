<!doctype html>
<html lang="en">
<head>
  <title>Websocket Client</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <header>
    <nav>
      <a href="/">Chat</a>
      <a href="#">Signup</a>
    </nav>
  </header>
  <div class="container">
    <h2>Signup</h2>
    <form id="signup_form" action="/signup" method="post">
        <label for="username">Username:</label><br>
        <input type="text" id="username" name="username"><br>
        <label for="email">email:</label><br>
        <input type="email" id="email" name="email"><br>
        <label for="password">Password:</label><br>
        <input type="password" id="password" name="password"><br><br>
        <input type="submit" value="Submit" onclick="createAccount()">
    </form>
      
  </div>
  <div id="alert-container"></div>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/3.1.9-1/crypto-js.js"></script>
  <script>
    const emailRegex = new RegExp("^[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}$");
    async function createAccount(){
      event.preventDefault();
      var username = document.getElementById("username").value;
      var email = document.getElementById("email").value;
      var passwordField = document.getElementById("password");
      if (username === "" || email === "" || passwordField.value === ""){
        alert("Please fill in all fields");
        return;
      }
      if (!emailRegex.test(email)){
        alert("Invalid email");
        return;
      }
      var hashedPassword = CryptoJS.SHA256(passwordField.value);
      hashedPassword = [hashedPassword].join('');
      var obj = {
        username: username,
        email: email,
        password: hashedPassword
      }
      console.log(obj);
      var answer = await fetch ('/signup', {
        method: "POST",
        headers: {
          'Content-Type': 'application/json'
        },
        body: JSON.stringify(obj)
      })
      if (answer.status == 200) {
        alert("Account created");
        window.location.href = "/";
      } else {
        alert("Account creation failed : " + answer.error);
      }
    }
  </script>
</body>
</html>